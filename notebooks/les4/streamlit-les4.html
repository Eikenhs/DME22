<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raoul Grouls &amp; Jan-Willem Lankhaar">

<title>Lesson 4 - Streamlit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="streamlit-les4_files/libs/clipboard/clipboard.min.js"></script>
<script src="streamlit-les4_files/libs/quarto-html/quarto.js"></script>
<script src="streamlit-les4_files/libs/quarto-html/popper.min.js"></script>
<script src="streamlit-les4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="streamlit-les4_files/libs/quarto-html/anchor.min.js"></script>
<link href="streamlit-les4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="streamlit-les4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="streamlit-les4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="streamlit-les4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="streamlit-les4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#communication-is-key" id="toc-communication-is-key" class="nav-link" data-scroll-target="#communication-is-key">Communication is key</a></li>
  <li><a href="#communication-is-more-than-mere-visualization" id="toc-communication-is-more-than-mere-visualization" class="nav-link" data-scroll-target="#communication-is-more-than-mere-visualization">Communication is more than mere visualization</a></li>
  </ul></li>
  <li><a href="#what-you-will-learn" id="toc-what-you-will-learn" class="nav-link" data-scroll-target="#what-you-will-learn">What you will learn</a></li>
  <li><a href="#why-streamlit" id="toc-why-streamlit" class="nav-link" data-scroll-target="#why-streamlit">Why <code>streamlit</code>?</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a>
  <ul class="collapse">
  <li><a href="#important-note" id="toc-important-note" class="nav-link" data-scroll-target="#important-note">Important note!</a></li>
  </ul></li>
  <li><a href="#how-a-web-app-works" id="toc-how-a-web-app-works" class="nav-link" data-scroll-target="#how-a-web-app-works">How a web app works</a>
  <ul class="collapse">
  <li><a href="#portforwarding" id="toc-portforwarding" class="nav-link" data-scroll-target="#portforwarding">A minor complication when working remote</a></li>
  </ul></li>
  <li><a href="#starting-with-streamlit" id="toc-starting-with-streamlit" class="nav-link" data-scroll-target="#starting-with-streamlit">Starting with <code>streamlit</code></a>
  <ul class="collapse">
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works">How it works</a></li>
  <li><a href="#streamlit-and-jupyter-notebooks-dont-go-together" id="toc-streamlit-and-jupyter-notebooks-dont-go-together" class="nav-link" data-scroll-target="#streamlit-and-jupyter-notebooks-dont-go-together"><code>streamlit</code> and Jupyter Notebooks don’t go together</a></li>
  </ul></li>
  <li><a href="#hello-world-in-streamlit" id="toc-hello-world-in-streamlit" class="nav-link" data-scroll-target="#hello-world-in-streamlit">Hello world in <code>streamlit</code></a>
  <ul class="collapse">
  <li><a href="#modifying-your-code" id="toc-modifying-your-code" class="nav-link" data-scroll-target="#modifying-your-code">Modifying your code</a></li>
  <li><a href="#adding-plots" id="toc-adding-plots" class="nav-link" data-scroll-target="#adding-plots">Adding plots</a>
  <ul class="collapse">
  <li><a href="#adding-interactivity" id="toc-adding-interactivity" class="nav-link" data-scroll-target="#adding-interactivity">Adding interactivity</a></li>
  <li><a href="#rearranging-the-plot-and-the-table" id="toc-rearranging-the-plot-and-the-table" class="nav-link" data-scroll-target="#rearranging-the-plot-and-the-table">Rearranging the plot and the table</a></li>
  </ul></li>
  <li><a href="#buttons" id="toc-buttons" class="nav-link" data-scroll-target="#buttons">Buttons</a></li>
  </ul></li>
  <li><a href="#a-more-interactive-map-app" id="toc-a-more-interactive-map-app" class="nav-link" data-scroll-target="#a-more-interactive-map-app">A more interactive map app</a>
  <ul class="collapse">
  <li><a href="#what-the-app-does" id="toc-what-the-app-does" class="nav-link" data-scroll-target="#what-the-app-does">What the app does</a></li>
  <li><a href="#structure-of-the-app" id="toc-structure-of-the-app" class="nav-link" data-scroll-target="#structure-of-the-app">Structure of the app</a></li>
  <li><a href="#structure-of-weather.py" id="toc-structure-of-weather.py" class="nav-link" data-scroll-target="#structure-of-weather.py">Structure of <code>weather.py</code></a></li>
  <li><a href="#knmi-module" id="toc-knmi-module" class="nav-link" data-scroll-target="#knmi-module">KNMI module</a></li>
  <li><a href="#layout-of-the-app" id="toc-layout-of-the-app" class="nav-link" data-scroll-target="#layout-of-the-app">Layout of the app</a></li>
  <li><a href="#plotting-data" id="toc-plotting-data" class="nav-link" data-scroll-target="#plotting-data">Plotting data</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 4 - Streamlit</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Raoul Grouls &amp; Jan-Willem Lankhaar </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Enabling a business user to interact with the data and the outcomes of a project is often very important. With <code>streamlit</code> you can easily create web apps that allow your client to interact with the data without having to deal with the details and complexities of the analysis.</p>
<section id="communication-is-key" class="level3">
<h3 class="anchored" data-anchor-id="communication-is-key">Communication is key</h3>
<p>Communication is a key part of data mining and exploration. In the business understanding phase, communication is essential to get a profound understanding of the client’s problem and to define the objective and data mining goals of the project.</p>
<p>In later phases, it is essential to translate the outcome of the project to the client and the organization.</p>
</section>
<section id="communication-is-more-than-mere-visualization" class="level3">
<h3 class="anchored" data-anchor-id="communication-is-more-than-mere-visualization">Communication is more than mere visualization</h3>
<p>Good communication of the outcomes of an analysis often requires well thought out and balanced data visualization. However, how effective and attractive they may be, showing only charts and visuals in a slide deck is not always sufficient.</p>
<p>Often, clients needs to be able to interact with the data (e.g.&nbsp;slice, filter, zoom etc.) in a dashboard.</p>
<p>With packages like <code>streamlit</code> it is relatively easy to build a web app or dashboard that allow a user to interact with the data.</p>
<p>In many projects, this ability can make or break the adoption of the project outcomes.</p>
</section>
</section>
<section id="what-you-will-learn" class="level1">
<h1>What you will learn</h1>
<ul>
<li>The basic principles of a web app</li>
<li>How to configure your development environment to work with <code>streamlit</code></li>
<li>How to create a simple <code>streamlit</code> app</li>
<li>The most important <code>streamlit</code> methods</li>
</ul>
</section>
<section id="why-streamlit" class="level1">
<h1>Why <code>streamlit</code>?</h1>
<p>There are many options for web app frameworks in Python. Rather simple (e.g.&nbsp;<a href="https://plotly.com/dash/">Dash</a> for dashboards or <a href="https://flet.dev/">Flet</a> for more general purpose web apps) and more sophisticated/flexible frameworks (e.g.&nbsp;<a href="https://flask.palletsprojects.com/en/2.2.x/">Flask</a> or <a href="https://www.djangoproject.com/">Django</a>).</p>
<p>We have chosen <a href="https://streamlit.io/"><code>streamlit</code></a> because of its popularity and ease of use. It allows you to create a good looking web app with a few lines of code.</p>
</section>
<section id="installation" class="level1">
<h1>Installation</h1>
<p>You can install <code>streamlit</code> with <code>poetry</code>:</p>
<pre><code>$ poetry add streamlit</code></pre>
<section id="important-note" class="level3">
<h3 class="anchored" data-anchor-id="important-note">Important note!</h3>
<p><code>streamlit</code> is not compatible with Python 3.9.7. Even, if you don’t have that exact version installed, the installation may fail because your <code>pyproject.toml</code> is too permissive for the Python version.</p>
<p>To prevent this, modify your <code>pyproject.toml</code> as follows:</p>
<pre><code>[tool.poetry.dependencies]
python = "&gt;=3.9,&lt;3.9.7 || &gt;3.9.7,&lt;3.10"</code></pre>
<p>This line allows all Python versions between 3.9 and 3.10 except 3.9.7. Alternatively, you could fix the Python version that <code>poetry</code> uses to a specific version (other than 3.9.7).</p>
</section>
</section>
<section id="how-a-web-app-works" class="level1">
<h1>How a web app works</h1>
<p>A web app works in a client server architecture, which is a bit different from a normal command line app.</p>
<p>The basic concept is as follows:</p>
<ol type="1">
<li>It starts with running a web server, which is an app that continuously listens to a port on your computer (or a server) and waits for a request from a web browser.</li>
<li>If you enter a URL in your webbrowser, the browser sends a request to the web server.</li>
<li>On receipt of a request, the web server processes the request and returns an HTML page in response.</li>
<li>The web browser receives the response, renders an HTML page and shows the output in your web browser window.</li>
</ol>
<p>In full-fledged web apps (e.g.&nbsp;Django or Flask apps), steps 3 is the most difficult part. The web server hands over the request to your app and you have to make sure that your app processes it correctly and returns the proper response in all cases. In <code>streamlit</code> most of these complexities are abstracted away. So, you don’t have to worry about all kinds of technical details.</p>
<p>You can start the <code>streamlit</code> web server by running the following command from the command line:</p>
<pre class="{bash}"><code>$ streamlit run yourapp.py</code></pre>
<p>Note that instead of running your app directly with <code>python yourapp.py</code>, you run it via <code>streamlit</code>.</p>
<section id="portforwarding" class="level3">
<h3 class="anchored" data-anchor-id="portforwarding">A minor complication when working remote</h3>
<p>When you work remote (as we do on virtual machines), there is a minor complication. The web server that runs on your virtual machine cannot be reached directly from the outside world. We have to manually set up a connection from the ports of our local pc to the ports of the virtual machine.</p>
<p>Fortunately, Visual Studio Code provides functionality for this so-called port mapping (i.e.&nbsp;connecting a remote to a local port) and it only requires one simple additional step.</p>
<p>In the Ports panel, we have to configure a port forwarding. Once this has been done, we can submit requests in our local browser to the webserver on the (remote) virtual machine and we can receive responses.</p>
<p>Follow these steps to configure port forwarding in Visual Studio Code:</p>
<ol type="1">
<li><p>Select the <strong>PORTS</strong> tab in the lower panel of the screen</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/port_forwarding_01.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">The <strong>PORTS</strong> tab in Visual Studio Code can be used to configure a port forwarding.</figcaption><p></p>
</figure>
</div></li>
<li><p>Click on <strong>Forward a Port</strong></p></li>
<li><p>Enter the port number and press <code>&lt;Enter&gt;</code>. The port number is typically <code>8501</code> for <code>streamlit</code>, but it may be different in your case. You can find the port number the URL (after the <code>:</code>) that is shown when you run <code>streamlit</code>.</p></li>
</ol>
</section>
</section>
<section id="starting-with-streamlit" class="level1">
<h1>Starting with <code>streamlit</code></h1>
<section id="how-it-works" class="level2">
<h2 class="anchored" data-anchor-id="how-it-works">How it works</h2>
<p>If you want to turn your Python code into a <code>streamlit</code> app, all you have to do is add</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>to your code, call the proper <code>streamlit</code> “output” function in your code and run your code with <code>streamlit</code>.</p>
<p>Note that we abbreviate the <code>streamlit</code> with <code>st</code>, so that we can call the <code>streamlit</code> functions with the conveniently short prefix <code>st</code>.</p>
<p>The most basic output function is <code>st.write</code>. We will use <code>st.write</code> for our first ‘hello world’ <code>streamlit</code> app.</p>
</section>
<section id="streamlit-and-jupyter-notebooks-dont-go-together" class="level2">
<h2 class="anchored" data-anchor-id="streamlit-and-jupyter-notebooks-dont-go-together"><code>streamlit</code> and Jupyter Notebooks don’t go together</h2>
<p>As you can imagine, Jupyter Notebooks and <code>streamlit</code> don’t go together very well because of the client-server architecture. You have to write code in modules (separate <code>.py</code> files) and run them with <code>streamlit</code>.</p>
</section>
</section>
<section id="hello-world-in-streamlit" class="level1">
<h1>Hello world in <code>streamlit</code></h1>
<p>We will start with a simple but not very usefull app that shows a static text.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>st.write(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r"""</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    # Hello</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    My name is **[put your name her]**.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    This is my first `streamlit` app for the Data Mining &amp; Exploration course of the HU University of Applied Sciences Utrecht.</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="vs">    As you can see, the `st.write` function supports (GitHub flavored) Markdown.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="vs">    # Header 1</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="vs">    ## Header 2</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="vs">    ### Header 3</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="vs">    My personal goals for this course are:</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="vs">    1. Learn robust data analysis in Python</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="vs">    2. Conduct my own analysis in a project from my own practice</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="vs">    3. Have some fun!</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="vs">    $ x_{1,2} = \frac{-b \pm \sqrt{b^2 - 4ac</span><span class="sc">}}{2a}</span><span class="vs"> $</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="vs">    I'm a list:</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="vs">    - Item 1</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="vs">    - Item 2 with some _emphasis_</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="vs">    - Goto [Hello](#hello)</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="vs">    ---</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="vs">    """</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save this to a separate module <code>src/hello.py</code> and run the code from the command line in your shell:</p>
<pre><code>$ streamlit run src/hello.py</code></pre>
<p>You will see that the webserver has started and that it shows the address you can visit.</p>
<p>If you open the link in your browser (after having correctly configured port forwardig <a href="#portforwarding">as shown above</a>), you will see the output of your module.</p>
<p>As you can see, the <code>st.write</code> function is simple in use, but because it supports Markdown you can already create a good looking page with formatting, headers, lists, hyperlinks and mathematical equations. Visit <a href="https://github.github.com/gfm/#what-is-github-flavored-markdown-">this page</a> if you want to learn more about Markdown.</p>
<section id="modifying-your-code" class="level3">
<h3 class="anchored" data-anchor-id="modifying-your-code">Modifying your code</h3>
<p>If you want to change your code, you don’t have to stop the web server. All you have to do is save your module. The webserver will detect the changes and will ask you (in the right upper corner of your web page) whether you want to rerun the code.</p>
<p>If you click <strong>Always rerun</strong> it will automatically refresh your page each time you save your file.</p>
<p>Note that if not otherwise specified, <code>streamlit</code> will always run the entire module when you save it. This may involve long-during analyses. In these cases, it is wise to have the page not refreshed automatically.</p>
</section>
<section id="adding-plots" class="level2">
<h2 class="anchored" data-anchor-id="adding-plots">Adding plots</h2>
<p>We will now move on to a more realistic example with a plot. Create a new module <code>dashboard.py</code> for the code below and import the following:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> palmerpenguins</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the penguins data into a <code>pandas</code> dataframe.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> palmerpenguins.load_penguins()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is important to inform the user of a dashboard about how current the information on the dashboard is. Therefore, use <code>st.write</code> and the appropriate <code>datetime</code> function to add the folllowing text with the current date in it:</p>
<pre><code>    Last updated: &lt;dd MMM yyyy&gt;</code></pre>
<p>We want to enable the user to investigate the correlation between the bill depth and bill length of each penguin species. So, let’s add a plot that shows exactly that.</p>
<p>Add the following to your code:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a (scatter) plot object.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>f, ax <span class="op">=</span> mpl.subplots(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> sns.relplot(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>penguins, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'bill_length_mm'</span>, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'bill_depth_mm'</span>, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'species'</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>h.set_axis_labels(<span class="st">'Bill length (mm)'</span>, <span class="st">'Bill depth (mm)'</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>h.<span class="bu">set</span>(title<span class="op">=</span><span class="st">'Bill length and depth correlation across species'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the object to the page.</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>st.pyplot(h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that style and details matter on a dashboard. We add a title, use legible axis labels and add units to quantities.</p>
<section id="adding-interactivity" class="level3">
<h3 class="anchored" data-anchor-id="adding-interactivity">Adding interactivity</h3>
<p>We want to add interactivity to our dashboar. As a first step, we will add check boxes that allow us to select/unselect a species shown in the plot.</p>
<p>In order to be able to do so, we have to prepare the data. We need the following:</p>
<ul>
<li>A list <code>species</code> with the names of the species.</li>
<li>A list of booleans <code>is_checked</code> (the same length as <code>species</code>) that indicates which species are selected.</li>
<li>A dataframe <code>penguins_selection</code> that includes only data for the selected species.</li>
</ul>
<p>Complete the following code with the appropriate <code>pandas</code> functions:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>species <span class="op">=</span> penguins[<span class="st">'species'</span>]...</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>is_selected <span class="op">=</span> []        <span class="co"># Will be initialized below.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Put your checkbox code (see below) here.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>penguins_selection <span class="op">=</span> penguins[ ... ]    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Hint: combine .isin() with species and is_selected.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add your plot to the page here.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code>streamlit</code>, checkboxes are created with <code>st.checkbox</code>.</p>
<p>Since the number of species is limited, we will position the checkboxes horizontally. Each checkbox will get its own column. Columns are created with <code>st.columns</code>. It returns a context manager that you can use to position objects:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> column_object:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create objects that are placed in this column</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We create a checkbox and a column for each species and combine them in pairs with <code>zip()</code>:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> st.columns(spec<span class="op">=</span><span class="bu">len</span>(species), gap<span class="op">=</span><span class="st">'small'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, spec <span class="kw">in</span> <span class="bu">zip</span>(columns, species):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> col:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        is_selected.append(st.checkbox(spec, key<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>spec<span class="sc">}</span><span class="ss">_checkbox'</span>, value<span class="op">=</span><span class="va">True</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make sure to place the dataframe filtering and the checkbox code above your <code>st.pyplot(...)</code>. The <code>key</code> argument comes in handy later.</p>
<p>If all went well, you are now able to select and unselect the species shown in the plot and the plot will change accordingly.</p>
<p>We also want to show the exact data, stored in our data frame. <code>streamlit</code> provides an easy way to add an interactive table to the page with the <code>st.dataframe()</code> function:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>st.dataframe(penguins_selection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want to hide details in the table and have neat and legible column titles. Use <code>pandas</code> to rename the columns properly and modify your code to have it only show the columns <code>species</code>, <code>bill_length_mm</code> and <code>bill_depth_mm</code>.</p>
</section>
<section id="rearranging-the-plot-and-the-table" class="level3">
<h3 class="anchored" data-anchor-id="rearranging-the-plot-and-the-table">Rearranging the plot and the table</h3>
<p>Not every business user is interested in the table and not every user is interested in the plot. To rearrange them, we will put the plot and the data table on their own tab. However, we want the check boxes to appear above both, because they apply to both.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tabs <span class="op">=</span> st.tabs([<span class="st">'Plot'</span>, <span class="st">'Table'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will create a list of tab context managers that we can use to position our objects in. Alternatively, we could use tuple unpacking and write:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plot_tab, table_tab <span class="op">=</span> st.tabs([<span class="st">'Plot'</span>, <span class="st">'Table'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tab[<span class="dv">0</span>]:    <span class="co"># Alternatively: with plot_tab</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Place objects on tab0.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tab[<span class="dv">1</span>]:    <span class="co"># or: table_tab</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Place objects on tab1.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modify your code so that it:</p>
<ul>
<li>Always shows the checkboxes</li>
<li>Shows the scatter plot on the <code>Plot</code> tab</li>
<li>Shows the data frame on the <code>Table</code> tab</li>
<li>Shows a table caption above the table on the <code>Table</code> tab (use the <code>st.caption</code> function)</li>
</ul>
</section>
</section>
<section id="buttons" class="level2">
<h2 class="anchored" data-anchor-id="buttons">Buttons</h2>
<p>Besides checkboxes and tabs, <code>streamlit</code> has a lot of other controls (so-called <em>widgets</em>) for user interaction. We will add a reset button that resets our species selection to the default selection (i.e.&nbsp;all species selected).</p>
<p>We will give the button the label <strong>Reset selection</strong> and when it is clicked by the user, the selection should be reset. We can achieve this by defining a callback function and attach it to the button. Callback functions should be defined <em>before</em> they can be used, so we will first define the function and then add the button:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reset_selection():</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Reset the species selection checkboxes to their default value (i.e. True)."""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> spec <span class="kw">in</span> species:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>spec<span class="sc">}</span><span class="ss">_checkbox'</span>        <span class="co"># Corresponds to the `key` argument used above.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        st.session_state[key] <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once, we have this function defined, we can add a button to the page (with <code>st.button</code>) and attach the callback function to it.</p>
<p>A few comments on this function. The function uses the <code>session_state</code>, a dictionary that holds the state of the variables of your app on the current page. You can use the <code>session_state</code> to look up variable values and modify them.</p>
<p>Also note that this function accesses a variable outside of its own scope (<code>species</code>), which is often not a desirable feature of a function but in this case it is defendable.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>st.button(<span class="st">'Reset selection'</span>, on_click<span class="op">=</span>reset_selection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This concludes this part of the lesson. You have now a simple dashboard. You may want extend it with other plots and controls.</p>
</section>
</section>
<section id="a-more-interactive-map-app" class="level1">
<h1>A more interactive map app</h1>
<p>In many projects, geographical data plays an important role (e.g.&nbsp;sales per regions). In this second part of the lesson, we walk through an app that shows some data on the map. On the fly, you will learn how to use some additional <code>streamlit</code> widgets.</p>
<p>Note that it is more a demonstration than an actual lesson.</p>
<p>Working with geographical data is an art in itself. In this course, we won’t dive into that. Fortunately, there are many packages and tools that make working with geographical data easy. <code>streamlit</code> also provides some basic mapping functionality out of the box.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/weather-app-screenshot.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">The weather app.</figcaption><p></p>
</figure>
</div>
<section id="what-the-app-does" class="level2">
<h2 class="anchored" data-anchor-id="what-the-app-does">What the app does</h2>
<p>The app loads hourly temperature observation history from the <a href="https://www.knmi.nl/kennis-en-datacentrum/achtergrond/data-ophalen-vanuit-een-script">KNMI weather stations</a> for a given number of days. The location of the weather stations is shown on a map.</p>
<p>If the user selects one or more weather stations (in a multiselect box), the temperature of the selected stations is plotted in a chart.</p>
<p>Below the map, the user may enter a search query for a location. Using a dedicated search engine (<code>Open Streetmap</code>’s <a href="https://nominatim.org/"><code>Nominatim</code></a>), the location is translated to coordinates and is plotted on the map.</p>
<p>In addition, the weighted average temperature (progression over time) of the weather stations nearest to the searched location is shown in the chart.</p>
<p>In the upper right corner of the dashboard, a <code>metric</code> widget shows yesterday’s average temperature (averaged across all weather stations) and its change with respect to the day before.</p>
</section>
<section id="structure-of-the-app" class="level2">
<h2 class="anchored" data-anchor-id="structure-of-the-app">Structure of the app</h2>
<p>The app is defined in the following modules:</p>
<ul>
<li><code>weather.py</code> The main module, that should be run with <code>streamlit</code>.</li>
<li><code>knmi.py</code> Module that defines some functions to load and average the KNMI temperature data.</li>
<li><code>settings.py</code> Settings for the app.</li>
</ul>
</section>
<section id="structure-of-weather.py" class="level2">
<h2 class="anchored" data-anchor-id="structure-of-weather.py">Structure of <code>weather.py</code></h2>
<p>One of the first things that you may notice when you inspect <code>weather.py</code> is that there is a mix of functions and a script that controls the widgets.</p>
<p>This script runs everytime the user refreshes the page. Because <code>streamlit</code> runs it everytime from top to bottom, certain things have te be done in a certain order. As a consequence, it is rather difficult to maintain a clear structure in the script.</p>
<p>The following tips may help to write a script that is as clear as possible:</p>
<ul>
<li>Limit data processing as much as possible. Move data processing code to different modules. Note that this may not always be possible. Then you may be able move code to separate functions within the module.</li>
<li>Use clear (and somewhat longer) variable names.</li>
<li>Heavily comment the module. Use more comments than you would otherwise do in a regular module.</li>
<li>Limit the number of widgets on the dashboard. Less is more!</li>
</ul>
<p>To avoid the use of variables before they are initialized (e.g.&nbsp;the text of the search query), a lot of controls are wrapped in <code>if</code> statements. A small convenience function <code>is_user_location_specified()</code> is defined to increase readability.</p>
</section>
<section id="knmi-module" class="level2">
<h2 class="anchored" data-anchor-id="knmi-module">KNMI module</h2>
<p>The KNMI module loads the temperature and weather station data by sending a web request with the codes of the station(s) and the desired period encoded in the URL. It is then parsed and cleaned using <code>pandas</code> functionality.</p>
<p>Note that this KNMI API only returns historical data with yesterday’s data being the most recent. Also note that most of the import and parsing details are controlled by the <code>settings</code> object, which improves maintainability of the code.</p>
</section>
<section id="layout-of-the-app" class="level2">
<h2 class="anchored" data-anchor-id="layout-of-the-app">Layout of the app</h2>
<p>Take a look at the basic layout of the app.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/weather-wireframe.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Wireframe that shows the basic layout of the weather app.</figcaption><p></p>
</figure>
</div>
<p>We used <code>st.columns</code> twice to arrange widgets next to each other:</p>
<ul>
<li>The title row was split in two in order to be able to position the metric widget besides the title.</li>
<li>The map and the chart were positioned in their own column.</li>
</ul>
<p>Study the code, to see how the context managers (<code>title_col</code>, <code>metric_col</code>, <code>map_col</code> and <code>chart_col</code>) control this behavior. Note that the width ratio of the column pairs differs (e.g.&nbsp;80% vs.&nbsp;20% for the <code>title_col</code> and <code>metric_col</code>).</p>
<p>If you work on your own project, you will discover that arranging objects on the page neatly is quite a challenge. It requires a lot of trial-and-error and tweaking of the parameters.</p>
</section>
<section id="plotting-data" class="level2">
<h2 class="anchored" data-anchor-id="plotting-data">Plotting data</h2>
<p>The charts are plotted with <code>seaborn</code>. However, you might as well use <code>matplotlib</code> objects right away. <code>seaborn</code> is relatively easy to use, while <code>matplotlib</code> provides more customization options.</p>
</section>
<section id="exercise" class="level2">
<h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<ol type="1">
<li><p>As you may have noticed, we have forgotten one important part of the dashboard. There is no indication as to how current the information on the dashboard is. Add proper control (e.g.&nbsp;a metric) that shows when the data was last updated.</p></li>
<li><p>Add a slider control to the dashboard that allows the user to select the date range that is shown in the chart.</p>
<p>Position the slider below the chart. It should range from one day (i.e.&nbsp;yesterday) to a maximum number of days that seems reasonable and useful to you. Set the default of days to <code>settings.days_back</code> and make the maximum number of days also a setting in <code>settings</code>.</p>
<p>Make sure the loading and processing time is acceptable when the user selects the maximum number of days.</p>
<p>Also make sure that the chart data and its title update correctly when the user adjusts the slider.</p></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>